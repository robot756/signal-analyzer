{"ast":null,"code":"export const processCSVData = file => {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = e => {\n      try {\n        const csvText = e.target.result;\n        const results = parseCSV(csvText);\n        resolve(results);\n      } catch (error) {\n        reject(error);\n      }\n    };\n    reader.onerror = () => reject(new Error(\"Ошибка чтения файла\"));\n    reader.readAsText(file);\n  });\n};\nconst parseCSV = csvText => {\n  const lines = csvText.split(\"\\n\");\n  const t = [];\n  const tenz = [];\n  const interf = [];\n  let lineCount = 0;\n  for (let i = 0; i < lines.length; i++) {\n    lineCount++;\n\n    // Пропускаем начальные строки (как в оригинальном коде)\n    if (lineCount < 6650) continue;\n    if (lineCount > 27000) break;\n    const line = lines[i].trim();\n    if (!line) continue;\n\n    // Разделяем по точкам (как в оригинальном dimread с разделителем \".\")\n    const fields = line.split(\".\");\n    if (fields.length >= 4) {\n      const tVal = parseFloat(fields[0]);\n      const tenzVal = parseFloat(fields[1]) * 0.00132 * 1.25;\n      const interfVal = parseFloat(fields[3]) + 0.04;\n      if (!isNaN(tVal) && !isNaN(tenzVal) && !isNaN(interfVal)) {\n        t.push(tVal);\n        tenz.push(tenzVal);\n        interf.push(interfVal);\n      }\n    }\n  }\n\n  // Поиск нулевых пересечений\n  const {\n    t0,\n    y0\n  } = findZeroCrossings(t, interf);\n\n  // Фильтрация близких точек\n  const {\n    filteredT0,\n    filteredY0\n  } = filterClosePoints(t0, y0, 100e-9);\n\n  // Расчет производной\n  const {\n    u_interf,\n    dudt_interf\n  } = calculateDerivative(filteredT0);\n  return {\n    t,\n    tenz,\n    interf,\n    t0: filteredT0,\n    y0: filteredY0,\n    u_interf,\n    dudt_interf\n  };\n};\nconst findZeroCrossings = (t, interf) => {\n  const t0 = [];\n  const y0 = [];\n  for (let i = 1; i < interf.length; i++) {\n    const prev = interf[i - 1];\n    const curr = interf[i];\n\n    // Проверяем пересечение нуля\n    if (prev <= 0 && curr > 0 || prev >= 0 && curr < 0) {\n      // Линейная интерполяция\n      const x1 = t[i - 1];\n      const x2 = t[i];\n      const y1 = prev;\n      const y2 = curr;\n      if (y2 !== y1) {\n        const t_zero = x1 - y1 * (x2 - x1) / (y2 - y1);\n        t0.push(t_zero);\n        y0.push(0);\n      }\n    }\n  }\n  return {\n    t0,\n    y0\n  };\n};\nconst filterClosePoints = (t0, y0, minDistance) => {\n  if (t0.length <= 1) return {\n    filteredT0: t0,\n    filteredY0: y0\n  };\n  const filteredT0 = [t0[0]];\n  const filteredY0 = [y0[0]];\n  for (let i = 1; i < t0.length; i++) {\n    if (t0[i] - filteredT0[filteredT0.length - 1] >= minDistance) {\n      filteredT0.push(t0[i]);\n      filteredY0.push(y0[i]);\n    }\n  }\n  return {\n    filteredT0,\n    filteredY0\n  };\n};\nconst calculateDerivative = t0 => {\n  const u_interf = new Array(t0.length).fill(0);\n  const dudt_interf = new Array(t0.length).fill(0);\n  for (let i = 0; i < t0.length; i++) {\n    if (i === 0) {\n      u_interf[i] = 0.63 / 4 * 1e-6;\n    } else {\n      u_interf[i] = u_interf[i - 1] + 0.63 / 4 * 1e-6;\n      const du_interf = u_interf[i] - u_interf[i - 1];\n      const dt_interf = t0[i] - t0[i - 1];\n      if (dt_interf !== 0) {\n        dudt_interf[i] = du_interf / dt_interf;\n      }\n    }\n  }\n  return {\n    u_interf,\n    dudt_interf\n  };\n};\nexport const generateChartData = results => {\n  const {\n    t,\n    tenz,\n    interf,\n    t0,\n    dudt_interf\n  } = results;\n\n  // Ограничиваем количество точек для производительности\n  const step = Math.ceil(t.length / 5000);\n  const limitedT = [];\n  const limitedTenz = [];\n  const limitedInterf = [];\n  for (let i = 0; i < t.length; i += step) {\n    limitedT.push(t[i]);\n    limitedTenz.push(tenz[i]);\n    limitedInterf.push(interf[i]);\n  }\n\n  // Подготавливаем данные для графиков\n  const chartData = {\n    original: {\n      t: limitedT,\n      tenz: limitedTenz,\n      interf: limitedInterf\n    },\n    processed: {\n      t0: t0.map(val => val - 51.5e-6),\n      dudt: dudt_interf,\n      correctedTenz: limitedT.map((val, idx) => ({\n        x: val + 50e-6,\n        y: -limitedTenz[idx] * 5000 + 0.38\n      }))\n    }\n  };\n  return chartData;\n};","map":{"version":3,"names":["processCSVData","file","Promise","resolve","reject","reader","FileReader","onload","e","csvText","target","result","results","parseCSV","error","onerror","Error","readAsText","lines","split","t","tenz","interf","lineCount","i","length","line","trim","fields","tVal","parseFloat","tenzVal","interfVal","isNaN","push","t0","y0","findZeroCrossings","filteredT0","filteredY0","filterClosePoints","u_interf","dudt_interf","calculateDerivative","prev","curr","x1","x2","y1","y2","t_zero","minDistance","Array","fill","du_interf","dt_interf","generateChartData","step","Math","ceil","limitedT","limitedTenz","limitedInterf","chartData","original","processed","map","val","dudt","correctedTenz","idx","x","y"],"sources":["C:/Users/regil/OneDrive/Рабочий стол/signal-analyzer/src/csvProcessor.js"],"sourcesContent":["export const processCSVData = (file) => {\r\n  return new Promise((resolve, reject) => {\r\n    const reader = new FileReader();\r\n\r\n    reader.onload = (e) => {\r\n      try {\r\n        const csvText = e.target.result;\r\n        const results = parseCSV(csvText);\r\n        resolve(results);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    };\r\n\r\n    reader.onerror = () => reject(new Error(\"Ошибка чтения файла\"));\r\n    reader.readAsText(file);\r\n  });\r\n};\r\n\r\nconst parseCSV = (csvText) => {\r\n  const lines = csvText.split(\"\\n\");\r\n  const t = [];\r\n  const tenz = [];\r\n  const interf = [];\r\n\r\n  let lineCount = 0;\r\n\r\n  for (let i = 0; i < lines.length; i++) {\r\n    lineCount++;\r\n\r\n    // Пропускаем начальные строки (как в оригинальном коде)\r\n    if (lineCount < 6650) continue;\r\n    if (lineCount > 27000) break;\r\n\r\n    const line = lines[i].trim();\r\n    if (!line) continue;\r\n\r\n    // Разделяем по точкам (как в оригинальном dimread с разделителем \".\")\r\n    const fields = line.split(\".\");\r\n\r\n    if (fields.length >= 4) {\r\n      const tVal = parseFloat(fields[0]);\r\n      const tenzVal = parseFloat(fields[1]) * 0.00132 * 1.25;\r\n      const interfVal = parseFloat(fields[3]) + 0.04;\r\n\r\n      if (!isNaN(tVal) && !isNaN(tenzVal) && !isNaN(interfVal)) {\r\n        t.push(tVal);\r\n        tenz.push(tenzVal);\r\n        interf.push(interfVal);\r\n      }\r\n    }\r\n  }\r\n\r\n  // Поиск нулевых пересечений\r\n  const { t0, y0 } = findZeroCrossings(t, interf);\r\n\r\n  // Фильтрация близких точек\r\n  const { filteredT0, filteredY0 } = filterClosePoints(t0, y0, 100e-9);\r\n\r\n  // Расчет производной\r\n  const { u_interf, dudt_interf } = calculateDerivative(filteredT0);\r\n\r\n  return {\r\n    t,\r\n    tenz,\r\n    interf,\r\n    t0: filteredT0,\r\n    y0: filteredY0,\r\n    u_interf,\r\n    dudt_interf,\r\n  };\r\n};\r\n\r\nconst findZeroCrossings = (t, interf) => {\r\n  const t0 = [];\r\n  const y0 = [];\r\n\r\n  for (let i = 1; i < interf.length; i++) {\r\n    const prev = interf[i - 1];\r\n    const curr = interf[i];\r\n\r\n    // Проверяем пересечение нуля\r\n    if ((prev <= 0 && curr > 0) || (prev >= 0 && curr < 0)) {\r\n      // Линейная интерполяция\r\n      const x1 = t[i - 1];\r\n      const x2 = t[i];\r\n      const y1 = prev;\r\n      const y2 = curr;\r\n\r\n      if (y2 !== y1) {\r\n        const t_zero = x1 - (y1 * (x2 - x1)) / (y2 - y1);\r\n        t0.push(t_zero);\r\n        y0.push(0);\r\n      }\r\n    }\r\n  }\r\n\r\n  return { t0, y0 };\r\n};\r\n\r\nconst filterClosePoints = (t0, y0, minDistance) => {\r\n  if (t0.length <= 1) return { filteredT0: t0, filteredY0: y0 };\r\n\r\n  const filteredT0 = [t0[0]];\r\n  const filteredY0 = [y0[0]];\r\n\r\n  for (let i = 1; i < t0.length; i++) {\r\n    if (t0[i] - filteredT0[filteredT0.length - 1] >= minDistance) {\r\n      filteredT0.push(t0[i]);\r\n      filteredY0.push(y0[i]);\r\n    }\r\n  }\r\n\r\n  return { filteredT0, filteredY0 };\r\n};\r\n\r\nconst calculateDerivative = (t0) => {\r\n  const u_interf = new Array(t0.length).fill(0);\r\n  const dudt_interf = new Array(t0.length).fill(0);\r\n\r\n  for (let i = 0; i < t0.length; i++) {\r\n    if (i === 0) {\r\n      u_interf[i] = (0.63 / 4) * 1e-6;\r\n    } else {\r\n      u_interf[i] = u_interf[i - 1] + (0.63 / 4) * 1e-6;\r\n      const du_interf = u_interf[i] - u_interf[i - 1];\r\n      const dt_interf = t0[i] - t0[i - 1];\r\n\r\n      if (dt_interf !== 0) {\r\n        dudt_interf[i] = du_interf / dt_interf;\r\n      }\r\n    }\r\n  }\r\n\r\n  return { u_interf, dudt_interf };\r\n};\r\n\r\nexport const generateChartData = (results) => {\r\n  const { t, tenz, interf, t0, dudt_interf } = results;\r\n\r\n  // Ограничиваем количество точек для производительности\r\n  const step = Math.ceil(t.length / 5000);\r\n  const limitedT = [];\r\n  const limitedTenz = [];\r\n  const limitedInterf = [];\r\n\r\n  for (let i = 0; i < t.length; i += step) {\r\n    limitedT.push(t[i]);\r\n    limitedTenz.push(tenz[i]);\r\n    limitedInterf.push(interf[i]);\r\n  }\r\n\r\n  // Подготавливаем данные для графиков\r\n  const chartData = {\r\n    original: {\r\n      t: limitedT,\r\n      tenz: limitedTenz,\r\n      interf: limitedInterf,\r\n    },\r\n    processed: {\r\n      t0: t0.map((val) => val - 51.5e-6),\r\n      dudt: dudt_interf,\r\n      correctedTenz: limitedT.map((val, idx) => ({\r\n        x: val + 50e-6,\r\n        y: -limitedTenz[idx] * 5000 + 0.38,\r\n      })),\r\n    },\r\n  };\r\n\r\n  return chartData;\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}